# Домашнее задание #4

1. ListCart
   - WorkerPool инициализируется и запускается прямо в listCart, т.е. ограничение в 5 sku одновременно относится
   к одному запросу (т.е. реализовано то, что в чатике назвали "локальный воркер-пул").

2. RateLimit (и Kubernetes)
   - Я добавил в проект манифесты k8s. Я захотел написать такую реализацию рейт лимита,
   которая бы позволяла динамически его изменять (т.к. при простой библиотечной реализации в случае запуска двухи более
   реплик в кубах, рейт лимит фактически переставал работать. Суммарно к ProductService уходило слишком много запросов.)
   - Я попробовал адаптировать под это известное API `ratelimit` от Убера. Решил изучить два возможных подхода к решению
   проблемы динамического изменения рейта.
   - Redis, судя по всему часто использующийся в качестве единого хранилища Token bucket, я не смог органично вписать
   в API. Кроме того, сам по себе подход вроде как не самый производительный и надежный.
   - Часто для установки рейт лимита используют конфигурационные сервера. Я решил пойти по немного наивному пути и,
   фактически, делить установленный лимит на количество реплик в кластере и отдавать каждой реплике этот уменьшенный
   лимит. Количество реплик узнаю с помощью go kubernetes client. Естественно, не прямо в рейт лимитере) При реализации
   постарался всё комментировать. Такой подход, как я уже писал, кажется мне достаточно наивным, но, тем не менее,
   теперь при запуске 5 реплик checkout не начинает постоянно пробивать rate limit product service.

3. Context
   - Прокидывал везде с самого начала, тут ничего менять не пришлось.

4. Аннулирование
   - Запускаю горутину в `app.go`, по каждому тику собираю из БД неоплаченные заказы старше 10 минут,
   в worker pool запускаю отмену всех выбранных заказов.

   
   
